# ==========================================================================
# ==========================================================================
# Create SPCE initial structure on Lattice and Minimize
# Written by: Amro Dodin (Geissler Group - UC Berkeley & LBL)
# NOTE: Requires -var SEED input to randomize molecule orientation
# ==========================================================================
# ==========================================================================

# ==========================================================================
# System Parameters
# ==========================================================================

# Physical Parameters
variable rho equal 1        # Density (g/cm^3)
variable MR equal 18.02     # Molar Mass (g/mol)
variable NA equal 6.022e23  # Avogadro's Constant (1/mol)

# Calculate Corresponding Lattice Constant (A)
variable a equal "(v_MR/(v_rho * v_NA))^(1/3)*1e8"

# Half Box Widths (in Lattice Coordinates)
# NB: Number of Particles = 8*Lx*Ly*Lz
# These Numbers correspond to Approximately 25 x 25 x 25 A
variable Lx equal 4
variable Ly equal 4
variable Lz equal 4

# Output Parameters
variable ThermoEvery equal 100

# Simulation Labels
variable label string spce

# ==========================================================================
# Simulation Set Up
# ==========================================================================

# Basic Specification
units real
dimension 3
boundary p p p
lattice sc $a

# Atom Style Specification
molecule h2o ${label}.mol
atom_style full

# Box Creation
region box block -${Lx} ${Lx} -${Ly} ${Ly} -${Lz} ${Lz} units lattice
create_box 2 box bond/types 1 angle/types 1 &
	   extra/bond/per/atom 2 extra/angle/per/atom 1 &
	   extra/special/per/atom 2

# ==========================================================================
# Force Field Parametrization
# ==========================================================================

# Atomic Masses
mass	       1 15.9994  # ODw
mass	       2 1.008	  # H

# Pair Coefficients
# Soft pair_style to unoverlap atoms
pair_style soft 1.0
pair_coeff * * 1.0

# Bonded Interactions
# Stiff Constraints to Fix TIP4P Geometry
bond_style harmonic
angle_style harmonic
improper_style harmonic

# Masses Bond & Angle Coefficients
bond_coeff     1 1000000  1.0
angle_coeff    1 1000000  109.47

# ==========================================================================
# Create Water
# ==========================================================================

create_atoms   0 box mol h2o ${SEED}

# ==========================================================================
# Output Specification
# ==========================================================================

thermo ${ThermoEvery}

# ==========================================================================
# Minimize Under Soft Potential to Unoverlap
# ==========================================================================

minimize 0 0 2500 5000

# ==========================================================================
# Force Field Parametrization - LJ w/ Coulomb
# ==========================================================================

pair_style lj/cut/coul/long 10.0
pair_coeff * * 0 0
pair_coeff  1 1 0.15535 3.166
kspace_style pppm 1.0e-3

# ==========================================================================
# Minimize Under - LJ w/ Short Range Coulomb
# ==========================================================================

minimize 0 0 2500 5000

# ==========================================================================
# Write Output Data
# ==========================================================================

write_data data.${label}.min pair ij
